datasource db {
    provider = "postgresql"
    url      = "postgresql://remixiv:remixivpw@localhost:5433/remixivdb?schema=public"
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id        String   @id @default(cuid())
    email     String   @unique
    nonce     String   @unique @default(uuid())
    profileId String   @unique @map("profile_id")
    role      UserRole @default(User)
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    UserPassword UserPassword?
    UserProfile  UserProfile   @relation(fields: [profileId], references: [id])
    Wallets      Wallet[]

    @@index([email], name: "users_email")
    @@map("users")
}

model UserProfile {
    id        String   @id @default(cuid())
    nickname  String   @unique
    avatar    String   @default("")
    bio       String?
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    User User?

    @@map("user_profiles")
}

model UserPassword {
    hash   String
    userId String @unique @map("user_id")

    User User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@map("user_passwords")
}

model Wallet {
    address     String    @id
    userId      String    @map("user_id")
    createdAt   DateTime  @default(now()) @map("created_at")
    connectedAt DateTime? @map("connected_at")

    User User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@map("wallets")
}

enum UserRole {
    Superadmin
    Admin
    Tester
    User

    @@map("_user_roles")
}
